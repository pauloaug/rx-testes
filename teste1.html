<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>teste com Rx</title>

	<script type="text/javascript" src="d3.min.js"></script>
	<script type="text/javascript" src="Rx.min.js"></script>

</head>

<body>

	<div>
		<svg width="1000" height="800">

		</svg>

	</div>



<script>
	
	const intervalo = Rx.Observable.interval(10);
	const gerador = Rx.Observable.interval(1000).take(10);
	const mouse = Rx.Observable.fromEvent(document, 'mousemove');
	const click = Rx.Observable.fromEvent(document, 'click').map(x=> Math.random() * 100 | 0);
	// .subscribe(console.log);
	
	var color = d3.scaleOrdinal(d3.schemeCategory10);

	// const bar = gerador.map( x => {
	const bar = click.map( x => {

		var x0 = 900;
		var y0 = 50;
		var grupo = d3.select("svg").append("g")
								.attr("transform", `translate(${x0},${y0})`);

		grupo.append("circle")
			.attr("r", 20)
			.attr("stroke-width", "1")
			.attr("stroke", "black")
			.attr("fill", color(x));
			// .attr("fill", "transparent");

		grupo.append("text")
			.text(x)
			.attr("font-size", "20")
			.attr("dy","0.35em")
			.attr("dx", `${-0.3 * x.toString().length}em`);

		intervalo
			.filter( x => x<1000 )
			.subscribe( d => {
			grupo
			  .attr("transform", function(e){
					return `translate(${x0-d},${y0})`
			  });
		});

		return grupo.node();
	});

	bar.subscribe();

	// var comb = Rx.Observable
	// 						.combineLatest(gerador, intervalo)
	// 						.subscribe(console.log);

							// .combineLatest(gerador,vis, (b,v) => v ? b : null )
							// .filter(x=> x != null);

	// comb.subscribe(x=> console.log(`gerador e visivel?  ${x}`));



	// bar.delay(100).map(x=> {
	// 	x.attr("transform", "translate(30)");
	// }).subscribe(console.log);


</script>
</body>
</html>
